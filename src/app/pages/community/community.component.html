<div class="community-page">
  <div class="community-container">

    <div class="community-header">
      <h2>ğŸ‘¥ Community</h2>
      <p>Connect with movie lovers and share your thoughts</p>
      <button class="create-post-btn" (click)="openCreate()">âœï¸ Create Post</button>
    </div>

    <div class="community-content">

      <!-- TABS -->
      <div class="section-tabs">
        <button class="tab" [class.active]="activeTab==='reviews'" (click)="setTab('reviews')">ğŸ“ Reviews</button>
        <button class="tab" [class.active]="activeTab==='discussions'" (click)="setTab('discussions')">ğŸ’¬
          Discussions</button>
        <button class="tab" [class.active]="activeTab==='rankings'" (click)="setTab('rankings')">ğŸ† Rankings</button>
        <button class="tab" [class.active]="activeTab==='events'" (click)="setTab('events')">ğŸ¯ Events</button>
      </div>
      <div class="community-loader" *ngIf="isLoading">
        Loading community data...
      </div>

      <!-- TAB CONTENT -->
      <app-reviews-tab [hidden]="activeTab !== 'reviews'" [posts]="posts" [comments]="comments"
        [commentDraft]="commentDraft" [openCommentId]="openCommentId" (like)="like($event)" (share)="openShare($event)"
        (toggleComment)="toggleComment($event)" (sendComment)="sendComment($event)" (delete)="deleteReview($event)"
        [editMovieResults]="editMovieResults" (reload)="loadReviews()">
      </app-reviews-tab>

      <app-discussions-tab [hidden]="activeTab !== 'discussions'" [discussions]="discussions">
      </app-discussions-tab>

      <app-rankings-tab [hidden]="activeTab !== 'rankings'" [topMovies]="topMovies">
      </app-rankings-tab>

      <app-events-tab [hidden]="activeTab !== 'events'" [events]="events" (refresh)="loadEvents(true)">
      </app-events-tab>


    </div>
    <!-- CREATE REVIEW MODAL -->
    <div class="modal-backdrop" *ngIf="ifCreated" (click)="closeCreate()">
      <div class="modal" (click)="$event.stopPropagation()">

        <div class="modal-head">
          <h3 class="title">Write a review</h3>
          <button class="x" (click)="closeCreate()">âœ•</button>
        </div>

        <input class="movie-search" type="text" [value]="searchText" (input)="onSearchChange($any($event.target).value)"
          placeholder="Search movie name..." />

        <div class="search-list" *ngIf="searchResults.length">
          <button class="search-item" *ngFor="let m of searchResults" (click)="selectMovie(m)">
            <img *ngIf="m.posterPath" [src]="'https://image.tmdb.org/t/p/w92' + m.posterPath" />
            <span>{{ m.title }}</span>
          </button>
        </div>

        <div class="selected-movie" *ngIf="selectedMovie">
          <img *ngIf="selectedMovie.posterPath" [src]="'https://image.tmdb.org/t/p/w92' + selectedMovie.posterPath" />
          <div>
            <div class="title">{{ selectedMovie.title }}</div>
            <div class="sub">TMDB: {{ selectedMovie.tmdbMovieId }}</div>
          </div>
        </div>

        <form [formGroup]="form" (ngSubmit)="submit()" class="create-form">
          <input type="hidden" formControlName="movieId" />

          <input type="number" formControlName="rating" min="1" max="10" placeholder="Rating (1-10)" />

          <textarea formControlName="comment" placeholder="Share your thoughts..."></textarea>

          <button type="submit" [disabled]="form.invalid || !selectedMovie">
            Post
          </button>
        </form>

      </div>
    </div>


  </div>
</div>