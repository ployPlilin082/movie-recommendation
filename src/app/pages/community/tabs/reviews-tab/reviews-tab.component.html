<div class="post-card" *ngFor="let p of posts; trackBy: trackById">

  <!-- HEADER -->
  <div class="post-header">
    <div class="user-avatar">
      {{ (p.userName || '?').charAt(0) | uppercase }}

      <ng-template #fallback>
        {{ (p.userName || '?').charAt(0) | uppercase }}
      </ng-template>
    </div>

    <div class="meta">
      <div class="username">{{ p.userName }}</div>
      <div class="post-time">{{ p.createdAt | date:'short' }}</div>

      <div class="movie-title" *ngIf="p.movieTitle">
        ğŸ¬ {{ p.movieTitle }}
      </div>
    </div>
  </div>

  <!-- MOVIE POSTER -->
  <div class="movie-thumb" *ngIf="p.posterPath">
    <img [src]="'https://image.tmdb.org/t/p/w154' + p.posterPath" />
  </div>

  <!-- CONTENT -->
<div class="post-content">

  <!-- VIEW MODE -->
  <ng-container *ngIf="editingPostId !== p.postId; else editMode">
    {{ p.comment }}
    <div class="rating">â­ {{ p.rating }}</div>
  </ng-container>

  <!-- EDIT MODE -->
  <ng-template #editMode>
  <div class="edit-box">
    <textarea
      class="edit-textarea"
      [(ngModel)]="editDraft!.comment"
      placeholder="à¹à¸à¹‰à¹„à¸‚à¸„à¸§à¸²à¸¡à¸„à¸´à¸”à¹€à¸«à¹‡à¸™..."
    ></textarea>
    <!-- CHANGE MOVIE -->
<div class="edit-movie">
  <div class="current-movie" *ngIf="editDraft?.movieTitle">
    ğŸ¬ {{ editDraft?.movieTitle }}
  </div>

  <input
    class="edit-movie-search"
    type="text"
    placeholder="à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸«à¸™à¸±à¸‡â€¦"
    [(ngModel)]="editMovieSearch"
    (input)="searchMovieForEdit(editMovieSearch)"
  />

  <div class="edit-movie-results" *ngIf="editMovieResults.length">
    <button
      class="edit-movie-item"
      *ngFor="let m of editMovieResults"
      (click)="selectEditMovie(m)"
    >
      <img
        *ngIf="m.posterPath"
        [src]="'https://image.tmdb.org/t/p/w92' + m.posterPath"
      />
      <span>{{ m.title }}</span>
    </button>
  </div>
</div>


    <div class="edit-footer">
      <input
        class="edit-rating"
        type="number"
        min="1"
        max="10"
        [(ngModel)]="editDraft!.rating"
      />

      <div class="edit-actions">
        <button class="btn-save" (click)="saveEdit(p)">âœ… à¸šà¸±à¸™à¸—à¸¶à¸</button>
        <button class="btn-cancel" (click)="cancelEdit()">âŒ à¸¢à¸à¹€à¸¥à¸´à¸</button>
      </div>
    </div>
  </div>
</ng-template>



  <!-- ACTIONS -->
  <div class="post-footer">

    <!-- ACTIONS -->
    <div class="post-actions">
      <button (click)="like.emit(p)">
        ğŸ‘ Like <span *ngIf="p.likeCount">({{ p.likeCount }})</span>
      </button>

      <button (click)="toggleComment.emit(p.postId)">
        ğŸ’¬ Comment
      </button>

      <button (click)="share.emit(p)">
        ğŸ“¤ Share <span *ngIf="p.shareCount">({{ p.shareCount }})</span>
      </button>
    </div>
 <div class="post-owner-actions" *ngIf="p.isMine">
  <button (click)="startEdit(p)">âœï¸ à¹à¸à¹‰à¹„à¸‚</button>
  <button (click)="delete.emit(p)">ğŸ—‘ à¸¥à¸š</button>
</div>



    <!-- COMMENTS -->
    <div class="comment-section" *ngIf="openCommentId === p.postId">

      <!-- COMMENT LIST -->
      <div class="comment-item" *ngFor="let c of comments[p.postId]">
        <div class="comment-avatar">
          {{ (c.userName || '?').charAt(0) | uppercase }}
        </div>

        <div class="comment-body">
          <div class="comment-user">{{ c.userName }}</div>
          <div class="comment-text">{{ c.text }}</div>
        </div> 
      </div>

      <!-- COMMENT INPUT -->
      <div class="quick-comment">
        <div class="comment-avatar me">
          {{ (p.userName || '?').charAt(0) | uppercase }}
        </div>

        <input class="comment-input" [(ngModel)]="commentDraft[p.postId]" placeholder="Write a commentâ€¦"
          (keyup.enter)="sendComment.emit(p.postId)" />
      </div>

    </div>


  </div>
</div>